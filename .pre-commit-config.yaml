# EMSN 2.0 Pre-commit hooks
# Installeer met: pip install pre-commit && pre-commit install
# Handmatig draaien: pre-commit run --all-files

repos:
  # Code formatting check (niet auto-fix om bestaande code niet te breken)
  - repo: https://github.com/psf/black
    rev: 24.10.0
    hooks:
      - id: black
        args: ['--check', '--diff']
        language_version: python3.11

  # Import sorting check
  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        args: ['--check-only', '--diff']

  # Linting
  - repo: https://github.com/pycqa/flake8
    rev: 7.1.1
    hooks:
      - id: flake8
        args:
          - '--max-line-length=120'
          - '--ignore=E501,W503,E203'  # Line too long (handled by black), line break before binary operator
        exclude: ^(venv/|\.venv/)

  # Type checking (optioneel - kan traag zijn)
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.13.0
    hooks:
      - id: mypy
        args:
          - '--ignore-missing-imports'
          - '--no-error-summary'
          - '--no-strict-optional'
        additional_dependencies:
          - types-requests
          - types-PyYAML
        files: ^scripts/core/  # Alleen core modules checken
        pass_filenames: false

  # Unit tests
  - repo: local
    hooks:
      - id: pytest-check
        name: pytest-check
        entry: bash -c 'cd /home/ronny/emsn2 && source venv/bin/activate && python -m pytest tests/ -v --tb=short -q'
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-commit]

  # YAML syntax check
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: check-yaml
        args: ['--unsafe']  # Toestaan van custom YAML tags
      - id: end-of-file-fixer
      - id: trailing-whitespace
      - id: check-added-large-files
        args: ['--maxkb=1000']  # Max 1MB
      - id: check-merge-conflict
      - id: debug-statements  # Check voor vergeten pdb/breakpoint

  # Security check
  - repo: https://github.com/PyCQA/bandit
    rev: 1.8.2
    hooks:
      - id: bandit
        args:
          - '-ll'  # Alleen medium en hoger
          - '--skip=B101,B311'  # Skip assert en random warnings
        exclude: ^tests/

# Configuratie voor CI/CD
ci:
  autofix_commit_msg: 'style: auto-fix pre-commit issues'
  autoupdate_commit_msg: 'chore: update pre-commit hooks'
