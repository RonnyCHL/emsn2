% EMSN Report LaTeX Template for Pandoc
% Generates professional PDFs with EMSN logo header

\documentclass[11pt,a4paper]{article}

% Margins
\usepackage[margin=2.5cm, top=3.5cm, bottom=2.5cm]{geometry}

% Unicode support with XeLaTeX
\usepackage{fontspec}
\defaultfontfeatures{Mapping=tex-text,Scale=MatchLowercase}

% Try to use system fonts, fallback to defaults
\IfFontExistsTF{DejaVu Sans}{
    \setmainfont{DejaVu Sans}
}{
    \setmainfont{Liberation Sans}
}
\IfFontExistsTF{DejaVu Sans Mono}{
    \setmonofont{DejaVu Sans Mono}
}{
    \setmonofont{Liberation Mono}
}

% Dutch language support
\usepackage{polyglossia}
\setdefaultlanguage{dutch}

% Graphics for logo and images
\usepackage{graphicx}

% Background watermark package
\usepackage{eso-pic}
\usepackage{tikz}

% Colors
\usepackage{xcolor}
\definecolor{emsngreen}{HTML}{1B5E3B}
\definecolor{emsngray}{HTML}{666666}

% Headers and footers
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}

% Header configuration (small logo left, text right)
\fancyhead[L]{%
$if(logo-path)$
    \raisebox{-0.3\height}{\includegraphics[height=0.8cm]{$logo-path$}}%
$endif$
}
\fancyhead[R]{%
    \small\textcolor{emsngray}{Ecologisch Monitoring Systeem Nijverdal}%
}

% Footer configuration
\fancyfoot[L]{\small\textcolor{emsngray}{www.ronnyhullegie.nl}}
\fancyfoot[C]{\small\textcolor{emsngray}{\thepage}}
\fancyfoot[R]{\small\textcolor{emsngray}{$date$}}

% Header/footer lines
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

% Tables
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{array}

% Hyperlinks
\usepackage[colorlinks=true,linkcolor=emsngreen,urlcolor=emsngreen,breaklinks=true]{hyperref}

% Lists
\usepackage{enumitem}
\setlist{noitemsep,topsep=0pt}

% Paragraph spacing
\setlength{\parskip}{0.6em}
\setlength{\parindent}{0pt}

% Section formatting
\usepackage{titlesec}
\titleformat{\section}
    {\Large\bfseries\color{emsngreen}}
    {\thesection}{1em}{}
\titleformat{\subsection}
    {\large\bfseries\color{emsngreen}}
    {\thesubsection}{1em}{}
\titleformat{\subsubsection}
    {\normalsize\bfseries\color{emsngreen}}
    {\thesubsubsection}{1em}{}

% Images - constrain to text width
\usepackage{float}
\floatplacement{figure}{H}

% Force all images to fit within text width
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>0.7\textheight 0.7\textheight\else\Gin@nat@height\fi}
\makeatother
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}


% Code highlighting (from pandoc)
$if(highlighting-macros)$
$highlighting-macros$
$endif$

% Tight lists (from pandoc)
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Title page styling (no logo here - watermark is on background)
$if(title)$
\title{%
    \vspace{-1cm}%
    {\Huge\bfseries\color{emsngreen}$title$}%
$if(subtitle)$
    \\[0.5em]{\Large\color{emsngray}$subtitle$}%
$endif$
}
$else$
\title{}
$endif$

\author{}
\date{\color{emsngray}$date$}

\begin{document}

% Add watermark to every page EXCEPT page 1 (full page background logo - 28cm for A4)
$if(logo-path)$
\AddToShipoutPictureBG{%
    \ifnum\value{page}>1
        \AtPageCenter{%
            \begin{tikzpicture}[remember picture,overlay]
                \node[opacity=0.04] at (0,0) {\includegraphics[height=28cm]{$logo-path$}};
            \end{tikzpicture}%
        }%
    \fi
}
$endif$

$if(title)$
\maketitle
\thispagestyle{fancy}
$endif$

$body$

% Disclaimer section - appears at end of all reports
\vspace{2em}
\noindent\rule{\textwidth}{0.4pt}

\small
\textcolor{emsngray}{%
\textbf{Disclaimer}\\[0.5em]
Dit rapport is automatisch gegenereerd op basis van geluidsopnames die zijn geanalyseerd
met BirdNET, een AI-systeem voor het herkennen van vogelzang en vogelgeluiden. Hoewel
BirdNET een hoge nauwkeurigheid heeft, kunnen er fouten voorkomen bij de soortdeterminatie.
Zeldzame en opvallende soorten worden altijd getoetst door de gebruiker.\\[0.5em]
De gegevens zijn afkomstig van het Ecologisch Monitoring Systeem Nijverdal (EMSN), een
citizen science project van Ronny Hullegie.
}

\end{document}
