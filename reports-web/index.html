<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMSN Rapporten</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>EMSN Vogelrapporten</h1>
            <p class="subtitle">Automatisch gegenereerde rapporten over vogelactiviteit in Nijverdal</p>
        </header>

        <!-- Main tabs -->
        <div class="main-tabs">
            <button class="main-tab active" data-tab="reports">Rapporten bekijken</button>
            <button class="main-tab" data-tab="review">Review <span id="pending-count" class="badge-pending hidden">0</span></button>
            <button class="main-tab" data-tab="generate">Rapport genereren</button>
            <button class="main-tab" data-tab="schedule">Planning</button>
            <button class="main-tab" data-tab="email">E-mail beheer</button>
        </div>

        <!-- Reports view tab -->
        <div id="reports-tab" class="tab-content active">
            <div class="filters">
                <button class="filter-btn active" data-filter="all">Alle</button>
                <button class="filter-btn" data-filter="week">Wekelijks</button>
                <button class="filter-btn" data-filter="month">Maandelijks</button>
                <button class="filter-btn" data-filter="season">Seizoen</button>
                <button class="filter-btn" data-filter="year">Jaarlijks</button>
            </div>

            <div id="reports-list" class="reports-container">
                <div class="loading">Laden...</div>
            </div>
        </div>

        <!-- Review tab -->
        <div id="review-tab" class="tab-content">
            <div class="review-container">
                <h2>Rapport Review</h2>
                <p class="review-intro">Rapporten wachten op goedkeuring voordat ze verzonden worden. Je kunt hier tekst toevoegen of aanpassen.</p>

                <!-- Pending reports list -->
                <div class="review-section">
                    <h3>Te reviewen rapporten</h3>
                    <div id="pending-reports-list" class="pending-list">
                        <div class="loading">Laden...</div>
                    </div>
                </div>

                <!-- Report preview/edit panel (shown when report is selected) -->
                <div id="review-panel" class="review-panel hidden">
                    <div class="review-header">
                        <h3 id="review-title">Rapport Review</h3>
                        <button class="btn btn-small" onclick="closeReviewPanel()">Sluiten</button>
                    </div>

                    <!-- Custom text editor -->
                    <div class="review-editor">
                        <h4>Persoonlijke tekst toevoegen</h4>
                        <p class="editor-hint">Voeg hier je eigen tekst toe. Deze wordt in het rapport ingevoegd op de geselecteerde positie.</p>

                        <div class="form-group">
                            <label for="custom-text-position">Positie in rapport</label>
                            <select id="custom-text-position">
                                <option value="after_intro">Na de inleiding</option>
                                <option value="before_intro">Voor de inleiding</option>
                                <option value="before_conclusion">Voor de conclusie</option>
                                <option value="after_conclusion">Na de conclusie</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="custom-text">Je tekst (Markdown ondersteund)</label>
                            <textarea id="custom-text" rows="6" placeholder="Voer hier je eigen tekst in..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="reviewer-notes">Interne notities (niet zichtbaar in rapport)</label>
                            <textarea id="reviewer-notes" rows="3" placeholder="Optionele notities voor jezelf..."></textarea>
                        </div>

                        <div class="review-actions">
                            <button class="btn btn-secondary" onclick="previewReport()">Preview</button>
                            <button class="btn btn-primary" onclick="saveReviewChanges()">Opslaan</button>
                        </div>
                    </div>

                    <!-- Report preview -->
                    <div class="review-preview">
                        <h4>Rapport Preview</h4>
                        <div id="report-preview-content" class="preview-content">
                            <p class="no-data">Klik op "Preview" om het rapport met je tekst te bekijken</p>
                        </div>
                    </div>

                    <!-- Approve/Reject buttons -->
                    <div class="review-final-actions">
                        <button class="btn btn-danger" onclick="rejectReport()">Afwijzen</button>
                        <button class="btn btn-success" onclick="approveReport()">Goedkeuren & Verzenden</button>
                    </div>
                </div>

                <!-- Review history -->
                <div class="review-section">
                    <h3>Recent beoordeeld</h3>
                    <div id="review-history-list" class="history-list">
                        <div class="loading">Laden...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Generate report tab -->
        <div id="generate-tab" class="tab-content">
            <div class="generator-container">
                <h2>Nieuw Rapport Genereren</h2>
                <p class="generator-intro">Genereer een rapport met AI in de gewenste schrijfstijl.</p>

                <form id="generate-form" class="generator-form">
                    <!-- Report type selection -->
                    <div class="form-group">
                        <label for="report-type">Type rapport</label>
                        <select id="report-type" required>
                            <option value="">Selecteer type...</option>
                            <option value="week">Weekrapport (vorige week)</option>
                            <option value="season">Seizoensrapport</option>
                            <option value="year">Jaaroverzicht</option>
                            <option value="species">Soort-specifiek rapport</option>
                        </select>
                    </div>

                    <!-- Season options (shown when season selected) -->
                    <div id="season-options" class="form-group hidden">
                        <label for="season-select">Seizoen</label>
                        <select id="season-select">
                            <option value="">Meest recente seizoen</option>
                            <option value="winter">Winter (dec-feb)</option>
                            <option value="spring">Voorjaar (mrt-mei)</option>
                            <option value="summer">Zomer (jun-aug)</option>
                            <option value="autumn">Herfst (sep-nov)</option>
                        </select>
                        <label for="season-year">Jaar</label>
                        <input type="number" id="season-year" placeholder="bijv. 2025" min="2020" max="2030">
                    </div>

                    <!-- Year options (shown when year selected) -->
                    <div id="year-options" class="form-group hidden">
                        <label for="year-select">Jaar</label>
                        <input type="number" id="year-select" placeholder="bijv. 2024" min="2020" max="2030">
                    </div>

                    <!-- Species options (shown when species selected) -->
                    <div id="species-options" class="form-group hidden">
                        <label for="species-select">Vogelsoort</label>
                        <select id="species-select">
                            <option value="">Laden...</option>
                        </select>
                    </div>

                    <!-- Style selection -->
                    <div class="form-group">
                        <label for="style-select">Schrijfstijl</label>
                        <select id="style-select" required>
                            <option value="">Laden...</option>
                        </select>
                        <p id="style-description" class="style-description"></p>
                    </div>

                    <!-- Submit button -->
                    <button type="submit" id="generate-btn" class="btn btn-primary btn-large">
                        Genereer Rapport
                    </button>
                </form>

                <!-- Progress indicator -->
                <div id="generation-progress" class="progress-container hidden">
                    <div class="progress-spinner"></div>
                    <p class="progress-text">Rapport wordt gegenereerd met Claude AI...</p>
                    <p class="progress-subtext">Dit kan 30-60 seconden duren</p>
                </div>

                <!-- Result message -->
                <div id="generation-result" class="result-container hidden">
                    <div class="result-icon"></div>
                    <p class="result-message"></p>
                    <a href="#" id="result-link" class="btn btn-secondary hidden">Bekijk rapport</a>
                </div>
            </div>
        </div>

        <!-- Schedule tab -->
        <div id="schedule-tab" class="tab-content">
            <div class="schedule-container">
                <h2>Rapport Planning</h2>
                <p class="schedule-intro">Overzicht van automatische rapportgeneratie en geplande taken.</p>

                <!-- Current schedule overview -->
                <div class="schedule-section">
                    <h3>Automatische Planning</h3>
                    <p class="section-intro">Deze rapporten worden automatisch gegenereerd door systemd timers.</p>
                    <div id="schedule-list" class="schedule-list">
                        <div class="loading">Laden...</div>
                    </div>
                </div>

                <!-- Recent generation history -->
                <div class="schedule-section">
                    <h3>Recente Generaties</h3>
                    <p class="section-intro">Laatste rapportgeneraties en hun status.</p>
                    <div id="generation-history" class="history-list">
                        <div class="loading">Laden...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Email management tab -->
        <div id="email-tab" class="tab-content">
            <div class="email-container">
                <h2>E-mail Beheer</h2>
                <p class="email-intro">Beheer ontvangers voor automatische en handmatige rapportverzending.</p>

                <!-- Recipients list -->
                <div class="email-section">
                    <h3>Ontvangers</h3>
                    <div id="recipients-list" class="recipients-list">
                        <div class="loading">Laden...</div>
                    </div>

                    <!-- Add recipient form -->
                    <div class="add-recipient-form">
                        <h4>Nieuwe ontvanger toevoegen</h4>
                        <form id="add-recipient-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="recipient-email">E-mailadres *</label>
                                    <input type="email" id="recipient-email" required placeholder="naam@voorbeeld.nl">
                                </div>
                                <div class="form-group">
                                    <label for="recipient-name">Naam</label>
                                    <input type="text" id="recipient-name" placeholder="Optioneel">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="recipient-mode">Verzendmodus</label>
                                    <select id="recipient-mode">
                                        <option value="auto">Automatisch (bij elk nieuw rapport)</option>
                                        <option value="manual">Handmatig (alleen kopie op verzoek)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="recipient-style">Schrijfstijl</label>
                                    <select id="recipient-style">
                                        <option value="wetenschappelijk">Wetenschappelijk</option>
                                        <option value="populair">Populair</option>
                                        <option value="kinderen">Kinderen (8-12 jaar)</option>
                                        <option value="technisch">Technisch</option>
                                    </select>
                                    <small class="form-hint">Stijl van rapporten voor deze ontvanger</small>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Rapporttypes (voor automatische verzending)</label>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" name="report-type" value="weekly" checked> Wekelijks</label>
                                    <label><input type="checkbox" name="report-type" value="monthly" checked> Maandelijks</label>
                                    <label><input type="checkbox" name="report-type" value="seasonal" checked> Seizoen</label>
                                    <label><input type="checkbox" name="report-type" value="yearly" checked> Jaarlijks</label>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Toevoegen</button>
                        </form>
                    </div>
                </div>

                <!-- Send copy section -->
                <div class="email-section">
                    <h3>Rapport kopie versturen</h3>
                    <p class="section-intro">Stuur een kopie van een bestaand rapport naar geselecteerde ontvangers.</p>
                    <form id="send-copy-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="copy-report">Rapport</label>
                                <select id="copy-report" required>
                                    <option value="">Selecteer rapport...</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Ontvangers</label>
                            <div id="copy-recipients" class="checkbox-group">
                                <!-- Dynamically filled -->
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Verstuur kopie</button>
                    </form>
                    <div id="send-copy-result" class="result-message hidden"></div>
                </div>

                <!-- Test email section -->
                <div class="email-section">
                    <h3>Test e-mail versturen</h3>
                    <p class="section-intro">Test of de e-mailconfiguratie correct werkt.</p>
                    <form id="test-email-form" class="inline-form">
                        <input type="email" id="test-email-address" placeholder="E-mailadres" required>
                        <button type="submit" class="btn btn-secondary">Test versturen</button>
                    </form>
                    <div id="test-email-result" class="result-message hidden"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
