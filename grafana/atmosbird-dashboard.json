{
  "dashboard": {
    "title": "AtmosBird - Sky Monitoring",
    "tags": ["atmosbird", "sky", "astronomy"],
    "timezone": "browser",
    "schemaVersion": 16,
    "version": 1,
    "refresh": "5m",
    "panels": [
      {
        "id": 1,
        "title": "Latest Sky Capture",
        "type": "text",
        "gridPos": {"x": 0, "y": 0, "w": 12, "h": 8},
        "targets": [{
          "rawSql": "SELECT image_path, observation_timestamp, sky_type, cloud_coverage, brightness FROM sky_observations ORDER BY observation_timestamp DESC LIMIT 1",
          "format": "table"
        }],
        "options": {
          "mode": "markdown",
          "content": "Latest sky observation will be displayed here.\n\nNote: Image display requires custom panel or HTML embedding."
        }
      },
      {
        "id": 2,
        "title": "Total Sky Observations",
        "type": "stat",
        "gridPos": {"x": 12, "y": 0, "w": 4, "h": 4},
        "targets": [{
          "rawSql": "SELECT COUNT(*) FROM sky_observations",
          "format": "table"
        }],
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "thresholds": {
              "steps": [
                {"value": 0, "color": "blue"},
                {"value": 100, "color": "green"},
                {"value": 1000, "color": "yellow"}
              ]
            }
          }
        }
      },
      {
        "id": 3,
        "title": "Observations Today",
        "type": "stat",
        "gridPos": {"x": 16, "y": 0, "w": 4, "h": 4},
        "targets": [{
          "rawSql": "SELECT COUNT(*) FROM sky_observations WHERE observation_timestamp >= CURRENT_DATE",
          "format": "table"
        }],
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "thresholds": {
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 50, "color": "yellow"},
                {"value": 100, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 4,
        "title": "Total Timelapses",
        "type": "stat",
        "gridPos": {"x": 20, "y": 0, "w": 4, "h": 4},
        "targets": [{
          "rawSql": "SELECT COUNT(*) FROM timelapses",
          "format": "table"
        }],
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "thresholds": {
              "steps": [
                {"value": 0, "color": "grey"},
                {"value": 1, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 5,
        "title": "Disk Usage",
        "type": "gauge",
        "gridPos": {"x": 12, "y": 4, "w": 6, "h": 4},
        "targets": [{
          "rawSql": "SELECT disk_usage_percent FROM atmosbird_health ORDER BY measurement_timestamp DESC LIMIT 1",
          "format": "table"
        }],
        "fieldConfig": {
          "defaults": {
            "min": 0,
            "max": 100,
            "unit": "percent",
            "thresholds": {
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 70, "color": "yellow"},
                {"value": 90, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "id": 6,
        "title": "Last Capture Success",
        "type": "stat",
        "gridPos": {"x": 18, "y": 4, "w": 6, "h": 4},
        "targets": [{
          "rawSql": "SELECT CASE WHEN last_capture_success THEN 'SUCCESS' ELSE 'FAILED' END as status FROM atmosbird_health ORDER BY measurement_timestamp DESC LIMIT 1",
          "format": "table"
        }],
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "mappings": [
              {"value": "SUCCESS", "text": "✓ Success", "color": "green"},
              {"value": "FAILED", "text": "✗ Failed", "color": "red"}
            ]
          }
        }
      },
      {
        "id": 7,
        "title": "Cloud Coverage Trend (7 days)",
        "type": "timeseries",
        "gridPos": {"x": 0, "y": 8, "w": 12, "h": 8},
        "targets": [{
          "rawSql": "SELECT observation_timestamp as time, cloud_coverage as value FROM sky_observations WHERE observation_timestamp > NOW() - INTERVAL '7 days' ORDER BY observation_timestamp",
          "format": "time_series"
        }],
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "custom": {
              "axisLabel": "Cloud Coverage %",
              "fillOpacity": 30
            },
            "min": 0,
            "max": 100,
            "unit": "percent"
          }
        }
      },
      {
        "id": 8,
        "title": "Sky Brightness Trend (7 days)",
        "type": "timeseries",
        "gridPos": {"x": 12, "y": 8, "w": 12, "h": 8},
        "targets": [{
          "rawSql": "SELECT observation_timestamp as time, brightness as value FROM sky_observations WHERE observation_timestamp > NOW() - INTERVAL '7 days' ORDER BY observation_timestamp",
          "format": "time_series"
        }],
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "continuous-BlYlRd"},
            "custom": {
              "axisLabel": "Brightness",
              "fillOpacity": 30
            }
          }
        }
      },
      {
        "id": 9,
        "title": "Sky Type Distribution (24h)",
        "type": "piechart",
        "gridPos": {"x": 0, "y": 16, "w": 8, "h": 8},
        "targets": [{
          "rawSql": "SELECT sky_type, COUNT(*) as count FROM sky_observations WHERE observation_timestamp > NOW() - INTERVAL '24 hours' GROUP BY sky_type",
          "format": "table"
        }],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "hideFrom": {"tooltip": false, "viz": false, "legend": false}
            }
          },
          "overrides": []
        },
        "options": {
          "legend": {"displayMode": "list", "placement": "right"},
          "pieType": "pie",
          "reduceOptions": {"values": true, "calcs": ["lastNotNull"]},
          "tooltip": {"mode": "single"}
        }
      },
      {
        "id": 10,
        "title": "Moon Phase Progress",
        "type": "table",
        "gridPos": {"x": 8, "y": 16, "w": 8, "h": 8},
        "targets": [{
          "rawSql": "SELECT phase_name, ROUND(illumination_percent::numeric, 1) as illumination, age_days, observation_timestamp FROM moon_observations ORDER BY observation_timestamp DESC LIMIT 10",
          "format": "table"
        }]
      },
      {
        "id": 11,
        "title": "Star Observations (Nighttime)",
        "type": "table",
        "gridPos": {"x": 16, "y": 16, "w": 8, "h": 8},
        "targets": [{
          "rawSql": "SELECT observation_timestamp, star_count, bortle_scale_estimate, ROUND(sky_background_brightness::numeric, 1) as sky_bg FROM star_brightness ORDER BY observation_timestamp DESC LIMIT 10",
          "format": "table"
        }]
      },
      {
        "id": 12,
        "title": "Meteor Detections",
        "type": "stat",
        "gridPos": {"x": 0, "y": 24, "w": 6, "h": 4},
        "targets": [{
          "rawSql": "SELECT COUNT(*) FROM meteor_detections",
          "format": "table"
        }],
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "thresholds": {
              "steps": [
                {"value": 0, "color": "grey"},
                {"value": 1, "color": "orange"},
                {"value": 5, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "id": 13,
        "title": "Meteor Detection Details",
        "type": "table",
        "gridPos": {"x": 6, "y": 24, "w": 18, "h": 4},
        "targets": [{
          "rawSql": "SELECT detection_timestamp, ROUND(confidence_score::numeric, 1) as confidence, streak_length_pixels, ROUND(brightness_delta::numeric, 1) as brightness_increase FROM meteor_detections ORDER BY detection_timestamp DESC LIMIT 10",
          "format": "table"
        }]
      },
      {
        "id": 14,
        "title": "Recent Timelapses",
        "type": "table",
        "gridPos": {"x": 0, "y": 28, "w": 24, "h": 6},
        "targets": [{
          "rawSql": "SELECT created_timestamp, timelapse_type, start_time, end_time, frame_count, ROUND(duration_seconds::numeric, 1) as duration_sec, ROUND((file_size_bytes/1024/1024)::numeric, 2) as size_mb, video_path FROM timelapses ORDER BY created_timestamp DESC LIMIT 10",
          "format": "table"
        }]
      },
      {
        "id": 15,
        "title": "Observations per Hour (24h)",
        "type": "barchart",
        "gridPos": {"x": 0, "y": 34, "w": 12, "h": 8},
        "targets": [{
          "rawSql": "SELECT DATE_TRUNC('hour', observation_timestamp) as time, COUNT(*) as count FROM sky_observations WHERE observation_timestamp > NOW() - INTERVAL '24 hours' GROUP BY 1 ORDER BY 1",
          "format": "time_series"
        }]
      },
      {
        "id": 16,
        "title": "System Health",
        "type": "table",
        "gridPos": {"x": 12, "y": 34, "w": 12, "h": 8},
        "targets": [{
          "rawSql": "SELECT measurement_timestamp, photos_captured_today, ROUND(disk_usage_percent::numeric, 1) as disk_pct, last_capture_success FROM atmosbird_health ORDER BY measurement_timestamp DESC LIMIT 20",
          "format": "table"
        }]
      }
    ]
  },
  "overwrite": true
}
